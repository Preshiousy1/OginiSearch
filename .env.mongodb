# ===================================================
# MONGODB/ROCKSDB ARCHITECTURE - OPTIMIZED CONFIG
# ===================================================
# This is the active configuration for the MongoDB/RocksDB search engine
# Optimized for: 24GB RAM, 12 CPU cores (local development)

# === SERVER CONFIGURATION ===
NODE_ENV=development
PORT=3000
HOST=0.0.0.0

# === MONGODB CONFIGURATION ===
MONGODB_URI=mongodb://localhost:27017/ogini

# === ROCKSDB CONFIGURATION ===
ROCKSDB_PATH=./data/rocksdb

# === REDIS CONFIGURATION ===
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_URL=redis://localhost/
REDIS_USERNAME=default
REDIS_PASSWORD=password

# === API CONFIGURATION ===
ENABLE_SWAGGER=true
DOCS_PATH=api/docs
CORS_ORIGIN=*

# === CRITICAL: QUEUE CONCURRENCY (MOST IMPORTANT FOR PERFORMANCE) ===
# INDEXING_CONCURRENCY controls how many batch jobs run in parallel
# This is the PRIMARY bottleneck - increase this for faster bulk indexing
# For 12 CPU cores: 12-15 is optimal
INDEXING_CONCURRENCY=12

# BULK_INDEXING_CONCURRENCY is rarely used (only for internal bulk operations)
# Keep at 1 unless you have specific bulk indexing endpoints
BULK_INDEXING_CONCURRENCY=1

# DOC_PROCESSING_CONCURRENCY controls DocumentProcessorPool worker threads
# Fixed: Now actually respected (was previously hardcoded to CPU cores * 0.75)
# For 12 cores: 8-10 is optimal (defaults to 9 if not set)
DOC_PROCESSING_CONCURRENCY=8

# === PERSISTENCE CONFIGURATION ===
# Persist term postings to MongoDB every N batches (reduces write load)
# Default: 10 batches = ~90% reduction in MongoDB writes during bulk indexing
PERSISTENCE_INTERVAL_BATCHES=10

# === MEMORY MANAGEMENT ===
# Node.js heap size (adjust based on available RAM)
# For 24GB system: 6GB is safe, leaving room for MongoDB, Redis, etc.
NODE_OPTIONS=--max-old-space-size=6144 --expose-gc

# Term dictionary cache settings
# Must be large enough for: INDEXING_CONCURRENCY × avg_terms_per_batch
# With 12 concurrent batches × ~500 terms = 6000 minimum, +20% buffer = 7200
MAX_CACHE_SIZE=7500
EVICTION_THRESHOLD=0.80
GC_INTERVAL=45000

# === PERFORMANCE OPTIMIZATIONS ===
# Enable fast deduplication (skips expensive checks)
ENABLE_FAST_DEDUPLICATION=true

# Enable parallel text analysis
ENABLE_PARALLEL_ANALYSIS=true
ANALYSIS_WORKERS=8

# === LOGGING ===
LOG_LEVEL=info

# === RESET KEY (for admin operations) ===
RESET_KEY=test-reset-key-123
